import variable_data as vd;
import variable_round as vr;
import customText as tct;
import getunitID as id;

const s = StringBuffer();

function Event_Print(cp);
function Album_Ticket();
function Event_Info(cp);
function Event_Unit(top, down);

function event_score(cp)
{
	if (Kills(cp, AtLeast, 1, 90))
	{
		SetKills(cp, Subtract, 1, 90);
		
		if (Deaths(P7, Exactly, 0, "Event_type"))
		{
			if (Bring(cp, AtLeast, 1, 109, "Anywhere"))
			{
				SetScore(cp, Add, 25 +  dwrand() % 10, Custom);
			}
			else
			{
				SetScore(cp, Add, 20 +  dwrand() % 8, Custom);
			}
		}
		else if (Deaths(P7, Exactly, 1, "Event_type"))
		{
			if (Bring(cp, AtLeast, 1, 111, "Anywhere"))
			{
				SetScore(cp, Add, 25 +  dwrand() % 10, Custom);
			}
			else
			{
				SetScore(cp, Add, 20 +  dwrand() % 8, Custom);
			}
		}
		else if (Deaths(P7, Exactly, 2, "Event_type"))
		{
			if (Bring(cp, AtLeast, 1, 113, "Anywhere"))
			{
				SetScore(cp, Add, 25 + dwrand() & 10, Custom);
			}
			else
			{
				SetScore(cp, Add, 20 +  dwrand() % 8, Custom);
			}
		}
		
		SetScore(P6, Add, 100 + dwrand() % 10, Custom);
	}
	
	if (Score(P6, Custom, AtLeast, 1000) && Deaths(P7, AtMost, 0, "Event_Score"))
	{
		SetDeaths(Force1, SetTo, 1, "Event_Score");
		SetDeaths(P7, Add, 1, "Event_Score");
		SetResources(Force1, Add, 100, Ore);
	}
	if (Score(P6, Custom, AtLeast, 3000) && Deaths(P7, AtMost, 1, "Event_Score"))
	{
		SetDeaths(Force1, SetTo, 2, "Event_Score");
		SetDeaths(P7, Add, 1, "Event_Score");
		SetResources(Force1, Add, 1, Gas);
	}
	if (Score(P6, Custom, AtLeast, 5000) && Deaths(P7, AtMost, 2, "Event_Score"))
	{
		SetDeaths(Force1, SetTo, 3, "Event_Score");
		SetDeaths(P7, Add, 1, "Event_Score");
		CreateUnit(1, 64, "MedalGacha", Force1);
	}
	if (Score(P6, Custom, AtLeast, 7500) && Deaths(P7, AtMost, 3, "Event_Score"))
	{
		SetDeaths(Force1, SetTo, 4, "Event_Score");
		SetDeaths(P7, Add, 1, "Event_Score");
		Album_Ticket();
	}
	if (Score(P6, Custom, AtLeast, 10000) && Deaths(P7, AtMost, 4, "Event_Score"))
	{
		SetDeaths(Force1, SetTo, 5, "Event_Score");
		SetDeaths(P7, Add, 1, "Event_Score");
		CreateUnit(1, 7, "MedalGacha", Force1);
	}
	if (Score(P6, Custom, AtLeast, 11000) && Deaths(P7, AtMost, 5, "Event_Score"))
	{
		SetDeaths(Force1, SetTo, 6, "Event_Score");
		SetDeaths(P7, Add, 1, "Event_Score");
		SetResources(Force1, Add, 200, Ore);
	}
	if (Score(P6, Custom, AtLeast, 12000) && Deaths(P7, AtMost, 6, "Event_Score"))
	{
		SetDeaths(Force1, SetTo, 7, "Event_Score");
		SetDeaths(P7, Add, 1, "Event_Score");
		SetResources(Force1, Add, 2, Gas);
	}
	if (Score(P6, Custom, AtLeast, 13000) && Deaths(P7, AtMost, 7, "Event_Score"))
	{
		SetDeaths(Force1, SetTo, 8, "Event_Score");
		SetDeaths(P7, Add, 1, "Event_Score");
		SetResources(Force1, Add, 300, Ore);
	}
	if (Score(P6, Custom, AtLeast, 14000) && Deaths(P7, AtMost, 8, "Event_Score"))
	{
		SetDeaths(Force1, SetTo, 9, "Event_Score");
		SetDeaths(P7, Add, 1, "Event_Score");
		SetResources(Force1, Add, 3, Gas);
	}
	if (Score(P6, Custom, AtLeast, 15000) && Deaths(P7, AtMost, 9, "Event_Score"))
	{
		SetDeaths(Force1, SetTo, 10, "Event_Score");
		SetDeaths(P7, Add, 1, "Event_Score");
		CreateUnit(1, 7, "MedalGacha", Force1);
	}
	
	if (Deaths(P6, Exactly, 2, "Round"))
	{
		SetDeaths(P6, SetTo, 3, "Round");
		SetDeaths(Force1, SetTo, 999, "Event_Score");
	}
	if (Deaths(P6, Exactly, 3, "Round") && Deaths(Force1, Exactly, 0, "Event_Score"))
	{
		SetScore(P6, SetTo, 0, Custom);
		SetScore(Force1, SetTo, 0, Custom);
		SetDeaths(P6, SetTo, 0, "Round");
		SetDeaths(P7, SetTo, 0, "Event_Score");
		SetDeaths(P7, SetTo, 0, "event_index");
	}
	
	Event_Print(cp);
	Event_Info(cp);
}

function Album_Ticket()
{
	CreateUnit(1, 114, "JewelGacha", Force1);
}

function Event_Info(cp)
{
	switch(id.Unit_ID[cp])
	{
	case 110:
		if (Deaths(P7, AtLeast, 1, "event_index"))
		{
			s.printAt(0, "\x13\x04이벤트 번호 \x1F# \x04", dwread_epd(182 * 12 + 6));
			s.printAt(1, "\x13", ptr2s(GetTBLAddr(91)));
			
			if (Bring(P1, AtLeast, 1, 112, "Anywhere"))
			{ s.printAt(2, "\x13\x08", tct.str(0x57EEEB + 36 * 0), "\x04 - ",  dwread_epd(EPD(0x5822F4 + 4 * 0)), " \x04Score"); }
			else { s.printAt(2, "\n");}
			if (Bring(P2, AtLeast, 1, 112, "Anywhere"))
			{ s.printAt(3, "\x13\x0E", tct.str(0x57EEEB + 36 * 1), "\x04 - ",  dwread_epd(EPD(0x5822F4 + 4 * 1)), " \x04Score"); }
			else { s.printAt(3, "\n");}
			if (Bring(P3, AtLeast, 1, 112, "Anywhere"))
			{ s.printAt(4, "\x13\x0F", tct.str(0x57EEEB + 36 * 2), "\x04 - ",  dwread_epd(EPD(0x5822F4 + 4 * 2)), " \x04Score"); }
			else { s.printAt(4, "\n");}
			if (Bring(P4, AtLeast, 1, 112, "Anywhere"))
			{ s.printAt(5, "\x13\x10", tct.str(0x57EEEB + 36 * 3), "\x04 - ",  dwread_epd(EPD(0x5822F4 + 4 * 3)), " \x04Score"); }
			else { s.printAt(5, "\n");}
			if (Bring(P5, AtLeast, 1, 112, "Anywhere"))
			{ s.printAt(6, "\x13\x15", tct.str(0x57EEEB + 36 * 4), "\x04 - ",  dwread_epd(EPD(0x5822F4 + 4 * 4)), " \x04Score"); }
			else { s.printAt(6, "\n");}
	
			s.printAt(7, "\x13\x04이벤트 상위 보상");
			s.printAt(8, "\x13", ptr2s(GetTBLAddr(vr.event_Top[dwread_epd(182 * 12 + 6)] + 1)));
			s.printAt(9, "\x13\x04이벤트 하위 보상");
			s.printAt(10, "\x13", ptr2s(GetTBLAddr(vr.event_Down[dwread_epd(182 * 12 + 6)] + 1)));
		}
		else
		{
			s.printAt(3, "\n");
			s.printAt(4, "\x13\x04이벤트가 진행중이지 않습니다.");
			s.printAt(5, "\n");
		}
		id.Unit_ID[cp] = 1000;
		break;
	}
}

function Event_Print(cp)
{
	if (cp < 5)
	{
		if (Deaths(cp, Exactly, 1, "Event_Score"))	{ s.print("\n\x13\x04이벤트 점수 \x0F1000\x04점 달성 보상 - 100 \x0F골드\n"); SetDeaths(cp, SetTo, 0, "Event_Score"); }
		if (Deaths(cp, Exactly, 2, "Event_Score"))	{ s.print("\n\x13\x04이벤트 점수 \x0F3000\x04점 달성 보상 - 1 \x0FGas\n"); SetDeaths(cp, SetTo, 0, "Event_Score"); }
		if (Deaths(cp, Exactly, 3, "Event_Score"))	{ s.print("\n\x13\x04이벤트 점수 \x0F5000\x04점 달성 보상 - 1 \x0F메달 티켓\n"); SetDeaths(cp, SetTo, 0, "Event_Score"); }
		if (Deaths(cp, Exactly, 4, "Event_Score"))	{ s.print("\n\x13\x04이벤트 점수 \x0F7500\x04점 달성 보상 - 1 \x0F앨범 티켓\n"); SetDeaths(cp, SetTo, 0, "Event_Score"); }
		if (Deaths(cp, Exactly, 5, "Event_Score"))	{ s.print("\n\x13\x04이벤트 점수 \x0F10000\x04점 달성 보상 - 1 \x0F플레티넘 티켓\n"); SetDeaths(cp, SetTo, 0, "Event_Score"); }
		if (Deaths(cp, Exactly, 6, "Event_Score"))	{ s.print("\n\x13\x04이벤트 점수 \x0F11000\x04점 달성 보상 - 200 \x0F골드\n"); SetDeaths(cp, SetTo, 0, "Event_Score"); }
		if (Deaths(cp, Exactly, 7, "Event_Score"))	{ s.print("\n\x13\x04이벤트 점수 \x0F12000\x04점 달성 보상 - 2 \x0FGas\n"); SetDeaths(cp, SetTo, 0, "Event_Score"); }
		if (Deaths(cp, Exactly, 8, "Event_Score"))	{ s.print("\n\x13\x04이벤트 점수 \x0F13000\x04점 달성 보상 - 300 \x0F골드\n"); SetDeaths(cp, SetTo, 0, "Event_Score"); }
		if (Deaths(cp, Exactly, 9, "Event_Score"))	{ s.print("\n\x13\x04이벤트 점수 \x0F14000\x04점 달성 보상 - 3 \x0FGas\n"); SetDeaths(cp, SetTo, 0, "Event_Score"); }
		if (Deaths(cp, Exactly, 10, "Event_Score"))	{ s.print("\n\x13\x04이벤트 점수 \x0F15000\x04점 달성 보상 - 1 \x0F플레티넘 티켓\n"); SetDeaths(cp, SetTo, 0, "Event_Score"); }
		
		if (Deaths(cp, Exactly, 999, "Event_Score") && Score(P6, Custom, AtLeast, 1))
		{
			if (Score(P6, Custom, AtLeast, 20))
			{
				SetScore(P6, Subtract, 20, Custom);
				SetScore(Force1, Add, 20, Custom);
			}
			else if (Score(P6, Custom, AtMost, 19) && Score(P6, Custom, AtLeast, 10))
			{
				SetScore(P6, Subtract, 10, Custom);
				SetScore(Force1, Add, 10, Custom);
			}
			else
			{
				SetScore(P6, Subtract, 1, Custom);
				SetScore(Force1, Add, 1, Custom);
			}
		
			s.printAt(0, "\n");
			s.printAt(1, "\x13\x04이벤트 번호 \x1F# \x04", dwread_epd(182 * 12 + 6));
			s.printAt(2, "\x13", ptr2s(GetTBLAddr(91)));
			if (Bring(P1, AtLeast, 1, 112, "Anywhere"))
			{ s.printAt(3, "\x13\x08", tct.str(0x57EEEB + 36 * 0), "\x04 - ",  dwread_epd(EPD(0x5822F4 + 4 * 0)), " \x04Score"); }
			else { s.printAt(3, "\n");}
			if (Bring(P2, AtLeast, 1, 112, "Anywhere"))
			{ s.printAt(4, "\x13\x0E", tct.str(0x57EEEB + 36 * 1), "\x04 - ",  dwread_epd(EPD(0x5822F4 + 4 * 1)), " \x04Score"); }
			else { s.printAt(4, "\n");}
			if (Bring(P3, AtLeast, 1, 112, "Anywhere"))
			{ s.printAt(5, "\x13\x0F", tct.str(0x57EEEB + 36 * 2), "\x04 - ",  dwread_epd(EPD(0x5822F4 + 4 * 2)), " \x04Score"); }
			else { s.printAt(5, "\n");}
			if (Bring(P4, AtLeast, 1, 112, "Anywhere"))
			{ s.printAt(6, "\x13\x10", tct.str(0x57EEEB + 36 * 3), "\x04 - ",  dwread_epd(EPD(0x5822F4 + 4 * 3)), " \x04Score"); }
			else { s.printAt(6, "\n");}
			if (Bring(P5, AtLeast, 1, 112, "Anywhere"))
			{ s.printAt(7, "\x13\x15", tct.str(0x57EEEB + 36 * 4), "\x04 - ",  dwread_epd(EPD(0x5822F4 + 4 * 4)), " \x04Score"); }
			else { s.printAt(7, "\n");}
		}
		else if (Deaths(cp, Exactly, 999, "Event_Score") && Score(P6, Custom, Exactly, 0))
		{
			if (HighestScore(Custom) && Score(cp, Custom, AtLeast, 8000)) 
			{
				s.printAt(9, "\x13\x04이벤트 \x08상위\x04보상");
				s.printAt(10, "\x13",ptr2s(GetTBLAddr(vr.event_Top[dwread_epd(182 * 12 + 6)] + 1)));
				CreateUnit(1, vr.event_Top[dwread_epd(182 * 12 + 6)], "MedalGacha Create", CurrentPlayer);
			}
			else if (Score(cp, Custom, AtLeast, 4000))
			{ 
				s.printAt(9, "\x13\x04이벤트 \x08하위\x04보상");
				s.printAt(10, "\x13",ptr2s(GetTBLAddr(vr.event_Down[dwread_epd(182 * 12 + 6)] + 1)));
				CreateUnit(1, vr.event_Down[dwread_epd(182 * 12 + 6)], "MedalGacha Create", CurrentPlayer); 
			}
			
			SetDeaths(cp, SetTo, 0, "Event_Score");
		}
	}
}