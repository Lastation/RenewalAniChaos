import Princess.Variable as pv;
import Fairy.Variable as fv;
import Angel.Variable as av;

function Init();
function FixedUpdate(cp);
function Normal_Ticket(cp);
function Rare_Ticket(cp);

var Percent;
var Type;
var Unit;
var index;

const s = StringBuffer();

function Init()
{
	
}

function FixedUpdate(cp)
{
	Normal_Ticket(cp);
	Rare_Ticket(cp);
}

function Normal_Ticket(cp)
{
	if(Bring(cp, AtLeast, 1, 64, "MedalGacha Step 1"))
	{
		KillUnitAt(1, 64, "MedalGacha Step 1", cp);
		
		Percent = dwrand() % 10000;
		Type = dwrand() % 3;
	
	
		if (Percent <= 100)
		{ Unit = dwrand() % 3 + 5; }
		else if (Percent > 100 && Percent <= 2000)
		{ Unit = dwrand() % 2 + 8; }
		else if (Percent > 2000)
		{ Unit = dwrand() % 3 + 10; }
		
		switch(Type)
		{
		case 0:
			if 		(Percent <= 100 	+ pv.Album_Level[10]) 		{ Unit = dwrand() % 3 + 5; }
			else if 	(Percent <= 2000 	+ pv.Album_Level[10] * 20)	{ Unit = dwrand() % 2 + 8; }
			else if 	(Percent > 2000 		+ pv.Album_Level[10] *20)	{ Unit = dwrand() % 3 + 10; }
		
			index = pv.Unit_ID[Unit];
			CreateUnit(1, index, 5, cp);
			s.print(ptr2s(GetTBLAddr(index + 1)), "\x04 : ", ptr2s(pv.Create_Text[Unit]));
			break;
		case 1:
			if 		(Percent <= 100 	+ fv.Album_Level[8]) 		{ Unit = dwrand() % 3 + 5; }
			else if 	(Percent <= 2000 	+ fv.Album_Level[8] * 20)		{ Unit = dwrand() % 2 + 8; }
			else if 	(Percent > 2000 		+ fv.Album_Level[8] *20)		{ Unit = dwrand() % 3 + 10; }
		
			index = fv.Unit_ID[Unit];
			CreateUnit(1, index, 5, cp);
			s.print(ptr2s(GetTBLAddr(index + 1)), "\x04 : ", ptr2s(fv.Create_Text[Unit]));
			break;
		case 2:
			if 		(Percent <= 100 	+ av.Album_Level[12]) 		{ Unit = dwrand() % 3 + 5; }
			else if 	(Percent <= 2000 	+ av.Album_Level[12] * 20)	{ Unit = dwrand() % 2 + 8; }
			else if 	(Percent > 2000 		+ av.Album_Level[12] *20)	{ Unit = dwrand() % 3 + 10; }
		
			index = av.Unit_ID[Unit];
			CreateUnit(1, index, 5, cp);
			s.print(ptr2s(GetTBLAddr(index + 1)), "\x04 : ", ptr2s(av.Create_Text[Unit]));
			break;
		}
	}
}

function Rare_Ticket(cp)
{
	if(Bring(cp, AtLeast, 1, 7, "MedalGacha Step 1"))
	{
		KillUnitAt(1, 7, "MedalGacha Step 1", cp);
		
		Percent = dwrand() % 10000;
		Type = dwrand() % 3;

		if (Percent <= 100)
		{ Unit = dwrand() % 2 + 2; }
		else if (Percent > 100 && Percent <= 2000)
		{ Unit = 4; }
		else if (Percent > 2000)
		{ Unit = dwrand() % 3 + 5; }
		
		switch(Type)
		{
		case 0:
			if 		(Percent <= 100 	+ pv.Album_Level[10]) 		{ Unit = dwrand() % 2 + 2; }
			else if 	(Percent <= 2000 	+ pv.Album_Level[10] * 20)	{ Unit = 4; }
			else if 	(Percent > 2000 		+ pv.Album_Level[10] *20)	{ Unit = dwrand() % 3 + 5; }
			
			index = pv.Unit_ID[Unit];
			CreateUnit(1, index, 5, cp);
			s.print(ptr2s(GetTBLAddr(index + 1)), "\x04 : ", ptr2s(pv.Create_Text[Unit]));
			break;
		case 1:
			if 		(Percent <= 100 	+ fv.Album_Level[8]) 		{ Unit = dwrand() % 2 + 2; }
			else if 	(Percent <= 2000 	+ fv.Album_Level[8] * 20)		{ Unit = 4; }
			else if 	(Percent > 2000 		+ fv.Album_Level[8] *20)		{ Unit = dwrand() % 3 + 5; }
			
			index = fv.Unit_ID[Unit];
			CreateUnit(1, index, 5, cp);
			s.print(ptr2s(GetTBLAddr(index + 1)), "\x04 : ", ptr2s(fv.Create_Text[Unit]));
			break;
		case 2:
			if 		(Percent <= 100 	+ av.Album_Level[12]) 		{ Unit = dwrand() % 2 + 2; }
			else if 	(Percent <= 2000 	+ av.Album_Level[12] * 20)	{ Unit = 4; }
			else if 	(Percent > 2000 		+ av.Album_Level[12] *20)	{ Unit = dwrand() % 3 + 5; }
			
			index = av.Unit_ID[Unit];
			CreateUnit(1, index, 5, cp);
			s.print(ptr2s(GetTBLAddr(index + 1)), "\x04 : ", ptr2s(av.Create_Text[Unit]));
			break;
		}
	}
}