import PluginVariables as msqcvar;
import variable as v;
import func.trig as trg;
import func.trigepic as epic;
import func.trigadv as adv;
import func.sound as s;
import py_math;

function main(playerID)
{
       MoveUnit(All, "50 + 1n Tank", playerID, "Anywhere", "[Skill]HoldPosition");

       if (v.P_WaitMain[playerID] == 0)
       {
              if (v.P_CountMain[playerID] == 0)
              {
                     if (v.P_LoopMain[playerID] < 72) 
                     {
                            trg.Shape_Dot(playerID, 1, "40 + 1n Mojo", 0, 0);

                            KillUnitAt(All, "40 + 1n Mojo", "Anywhere", playerID);
                     }
                     else if (v.P_LoopMain[playerID] == 72) 
                     {
                            trg.Shape_NxNSquare(playerID, 1, "40 + 1n Guardian", 3, 50);

                            KillUnitAt(All, "40 + 1n Guardian", "Anywhere", playerID);
                     }

                     if (v.P_LoopMain[playerID] == 42)
                     {
                            s.CharacterVoice(13);
                     }

                     trg.Main_Wait(80);

                     v.P_LoopMain[playerID] += 1;

                     if (v.P_LoopMain[playerID] == 86)
                     {                        
                            v.P_CountMain[playerID] += 1;
                            v.P_LoopMain[playerID] = 0;
                     }
              }
              else if (v.P_CountMain[playerID] == 1)
              {
                     if (v.P_LoopMain[playerID] < 12) 
                     {
                            trg.Shape_Edge(playerID, 1, "Protoss Observer", 45, v.P_LoopMain[playerID], 32 * v.P_LoopMain[playerID]);
                            if (v.P_LoopMain[playerID] % 2 == 0)
                            {
                                   trg.Shape_Edge(playerID, 1, "50 + 1n Tank", 45, v.P_LoopMain[playerID], 32 * v.P_LoopMain[playerID]);

                                   MoveLocation(v.P_LocationID[playerID], v.P_UnitID[playerID], playerID, "Anywhere");
                                   MoveUnit(All, "50 + 1n Tank", playerID, "[Skill]Unit_Wait_ALL", v.P_LocationID[playerID]);
                                   Order("50 + 1n Tank", playerID, "Anywhere", Attack, v.P_LocationID[playerID]);  
                            }

                            KillUnitAt(All, "Protoss Observer", "Anywhere", playerID);
                     }

                     trg.Main_Wait(80);

                     v.P_LoopMain[playerID] += 1;

                     if (v.P_LoopMain[playerID] == 30)
                     {                        
                            s.CharacterVoice(14);

                            v.P_CountMain[playerID] += 1;
                            v.P_LoopMain[playerID] = 0;
                     }
              }  
              else if (v.P_CountMain[playerID] == 2)
              {
                     trg.Shape_Dot(playerID, 1, "40 + 1n Guardian", 0, 0);

                     KillUnitAt(All, "40 + 1n Guardian", "Anywhere", playerID);

                     trg.Main_Wait(80);

                     v.P_LoopMain[playerID] += 1;

                     if (v.P_LoopMain[playerID] == 23)
                     {                        
                            v.P_CountMain[playerID] += 1;
                            v.P_LoopMain[playerID] = 0;
                     }
              }      
              else if (v.P_CountMain[playerID] == 3)
              {
                     if (v.P_LoopMain[playerID] < 5) 
                     {
                            trg.Shape_Edge(playerID, 1, "50 + 1n Battlecruiser", 45, 3 + 2 * v.P_LoopMain[playerID], 75 + 75 * v.P_LoopMain[playerID]);
                            trg.Shape_Edge(playerID, 1, "80 + 1n Tank", 45, 3 + 2 * v.P_LoopMain[playerID], 75 + 75 * v.P_LoopMain[playerID]);

                            MoveLocation(v.P_LocationID[playerID], v.P_UnitID[playerID], playerID, "Anywhere");
                            Order("50 + 1n Battlecruiser", playerID, "Anywhere", Attack, v.P_LocationID[playerID]);  

                            KillUnitAt(All, "80 + 1n Tank", "Anywhere", playerID);
                     }
                     if (v.P_LoopMain[playerID] == 4)
                     {
                            s.CharacterVoice(15);
                     }

                     trg.Shape_Dot(playerID, 1, "40 + 1n Guardian", 0, 0);

                     KillUnitAt(All, "40 + 1n Guardian", "Anywhere", playerID);

                     trg.Main_Wait(80);

                     v.P_LoopMain[playerID] += 1;

                     if (v.P_LoopMain[playerID] == 45)
                     {                        
                            v.P_CountMain[playerID] += 1;
                            v.P_LoopMain[playerID] = 0;
                     }
              }      
              else if (v.P_CountMain[playerID] == 4)
              {
                     for (var i = 0; i < 6; i++)
                     {
                            if (Bring(playerID, AtLeast, 1, "50 + 1n Tank", "Anywhere"))
                            {
                                   trg.MoveLoc("50 + 1n Tank", playerID, 0, 0);
                                   RemoveUnitAt(1, "50 + 1n Tank", "Anywhere", playerID);

                                   if (i % 3 == 0)
                                   {
                                          trg.SkillUnit(playerID, 1, "80 + 1n Tank");
                                          trg.SkillUnit(playerID, 1, "60 + 1n Danimoth");
                                   }
                                   else if (i % 3 == 1)
                                   {
                                          trg.SkillUnit(playerID, 1, "Kakaru (Twilight)");
                                          trg.SkillUnit(playerID, 1, " Unit. Hoffnung 25000");
                                   }
                                   else if (i % 3 == 2)
                                   {
                                          trg.SkillUnit(playerID, 1, "60 + 1n Archon");
                                          trg.SkillUnit(playerID, 1, "40 + 1n Guardian");
                                   }
                            }
                     }

                     KillUnitAt(6, "50 + 1n Battlecruiser", "Anywhere", playerID);
                     KillUnitAt(All, "80 + 1n Tank", "Anywhere", playerID);
                     KillUnitAt(All, "60 + 1n Archon", "Anywhere", playerID);
                     KillUnitAt(All, "60 + 1n Danimoth", "Anywhere", playerID);
                     KillUnitAt(All, "Kakaru (Twilight)", "Anywhere", playerID);
                     KillUnitAt(All, " Unit. Hoffnung 25000", "Anywhere", playerID);
                     KillUnitAt(All, "40 + 1n Guardian", "Anywhere", playerID);

                     trg.Main_Wait(80);

                     v.P_LoopMain[playerID] += 1;

                     if (v.P_LoopMain[playerID] == 48)
                     {                        
                            v.P_CountMain[playerID] += 1;
                            v.P_LoopMain[playerID] = 0;
                     }
              }      
              else if (v.P_CountMain[playerID] == 5)
              {
                     if (v.P_LoopMain[playerID] == 0) 
                     {
                            trg.Shape_NxNSquare(playerID, 1, "100 + 1n Hyperion", 5, 75);

                            KillUnitAt(All, "60 + 1n Siege", "Anywhere", playerID);
                            KillUnitAt(All, "100 + 1n Hyperion", "Anywhere", playerID);
                     }
                     else if (v.P_LoopMain[playerID] == 1) 
                     {
                            trg.Shape_NxNSquare(playerID, 1, "100 + 1n Hyperion", 9, 75);

                            KillUnitAt(All, "100 + 1n Hyperion", "Anywhere", playerID);
                     }
                     else if (v.P_LoopMain[playerID] == 2) 
                     {
                            trg.Shape_NxNSquare(playerID, 1, "40 + 1n Guardian", 9, 75);
                            trg.Shape_NxNSquare(playerID, 1, "Protoss Dark Archon", 9, 75);

                            KillUnitAt(All, "40 + 1n Guardian", "Anywhere", playerID);
                            KillUnitAt(All, "Protoss Dark Archon", "Anywhere", playerID);
                     }
                     else if (v.P_LoopMain[playerID] == 3) 
                     {
                            trg.Shape_NxNSquare(playerID, 1, "Kakaru (Twilight)", 9, 75);
                            trg.Shape_NxNSquare(playerID, 1, " Unit. Hoffnung 25000", 9, 75);

                            KillUnitAt(All, "Kakaru (Twilight)", "Anywhere", playerID);
                            KillUnitAt(All, " Unit. Hoffnung 25000", "Anywhere", playerID);
                     }

                     trg.Main_Wait(80);

                     v.P_LoopMain[playerID] += 1;

                     if (v.P_LoopMain[playerID] == 4)
                     {                        
                            v.P_CountMain[playerID] += 1;
                            v.P_LoopMain[playerID] = 0;
                     }
              }     
              else if (v.P_CountMain[playerID] == 6)
              {
                     if (v.P_LoopMain[playerID] == 0)
                     {
                            var location = EPD(0x58DC4C) + v.P_LocationID[playerID] * 5;
                     
                            v.B_Speed[playerID] = 3;

                            MoveLocation(v.P_LocationID[playerID], v.P_UnitID[playerID], playerID, "Anywhere");
                            
                            v.B_BulletPos_X[playerID] = (dwread_epd(location + 0) + dwread_epd(location + 2)) / 2;
                            v.B_BulletPos_Y[playerID] = (dwread_epd(location + 1) + dwread_epd(location + 3)) / 2;
                            
                            v.B_Delta_X[playerID] = 50;
                            if (playerID >= 3) { v.B_Delta_X[playerID] = -v.B_Delta_X[playerID]; }
                            v.B_Delta_Y[playerID] = 0;
                            
                            v.B_IsHit[playerID] = 0;

                            epic.Shape_Dot(playerID, 1, "Zerg Defiler", 0, 0, 0);

                            trg.Main_Wait(80);

                            v.P_LoopMain[playerID] += 1;
                     }
                     else if (v.P_LoopMain[playerID] < 60)
                     {      
                            dwwrite_epd(v.P_LocationID[playerID] + 0, v.B_BulletPos_X[playerID] - 96);
                            dwwrite_epd(v.P_LocationID[playerID] + 2, v.B_BulletPos_X[playerID] + 96);
                            dwwrite_epd(v.P_LocationID[playerID] + 1, v.B_BulletPos_Y[playerID] - 96);
                            dwwrite_epd(v.P_LocationID[playerID] + 3, v.B_BulletPos_Y[playerID] + 96);

                            MoveUnit(All, "Zerg Defiler", playerID, "Anywhere", v.P_LocationID[playerID]);

                            for (var i = 0; i < v.B_Speed[playerID]; i++) 
                            {
                                   addloc(v.P_LocationID[playerID], v.B_Delta_X[playerID], v.B_Delta_Y[playerID]);
                                   trg.SkillUnit(playerID, 1, "Protoss Dark Archon");
                            }
                            KillUnitAt(All, "Protoss Dark Archon", "Anywhere", playerID);

                            v.B_BulletPos_X[playerID] += v.B_Speed[playerID] * v.B_Delta_X[playerID];
                            v.B_BulletPos_Y[playerID] += v.B_Speed[playerID] * v.B_Delta_Y[playerID];

                            if ((playerID >= 3 && (Bring(playerID, AtLeast, 1, "Zerg Defiler", "[Potal]Shop7") || Bring(playerID, AtLeast, 1, "Zerg Defiler", "[Potal]Potal7")))
                            || (playerID < 3 && (Bring(playerID, AtLeast, 1, "Zerg Defiler", "[Potal]Shop8") || Bring(playerID, AtLeast, 1, "Zerg Defiler", "[Potal]Potal8"))))
                            {
                                   trg.Main_Wait(80);

                                   v.P_CountMain[playerID] += 3;
                                   v.P_LoopMain[playerID] = 0;
                            }
                            else if (playerID < 3)
                            {
                                   if (Bring(P8, AtLeast, 1, "Buildings", v.P_LocationID[playerID]))
                                   {
                                          s.CharacterVoice(16);

                                          MoveLocation(v.P_LocationID[playerID], "Buildings", P8, v.P_LocationID[playerID]);
                                          MoveUnit(All, "Zerg Defiler", playerID, "Anywhere", v.P_LocationID[playerID]);

                                          trg.Main_Wait(80);

                                          v.P_CountMain[playerID] += 1;
                                          v.P_LoopMain[playerID] = 0;
                                   }
                                   else
                                   {
                                          trg.Main_Wait(80);

                                          v.P_LoopMain[playerID] += 1;
                                   }
                            }
                            else if (playerID >= 3)
                            {
                                   if (Bring(P7, AtLeast, 1, "Buildings", v.P_LocationID[playerID]))
                                   {
                                          s.CharacterVoice(16);

                                          MoveLocation(v.P_LocationID[playerID], "Buildings", P7, v.P_LocationID[playerID]);
                                          MoveUnit(All, "Zerg Defiler", playerID, "Anywhere", v.P_LocationID[playerID]);

                                          trg.Main_Wait(80);

                                          v.P_CountMain[playerID] += 1;
                                          v.P_LoopMain[playerID] = 0;
                                   }
                                   else
                                   {
                                          trg.Main_Wait(80);

                                          v.P_LoopMain[playerID] += 1;
                                   }
                            }
                     }
                     else if (v.P_LoopMain[playerID] == 60)
                     {      
                            trg.Main_Wait(80);

                            v.P_CountMain[playerID] += 3;
                            v.P_LoopMain[playerID] = 0;
                     }
              }
              else if (v.P_CountMain[playerID] == 7)
              {
                     if (v.P_LoopMain[playerID] == 0) 
                     {
                            adv.Shape_NxNSquareAt(playerID, "Zerg Defiler", 1, "100 + 1n Hyperion", 5, 75);

                            KillUnitAt(All, "100 + 1n Hyperion", "Anywhere", playerID);
                     }
                     else if (v.P_LoopMain[playerID] == 2) 
                     {
                            adv.Shape_NxNSquareAt(playerID, "Zerg Defiler", 1, "100 + 1n Hyperion", 9, 75);
                            adv.Shape_NxNSquareAt(playerID, "Zerg Defiler", 1, "60 + 1n Siege", 9, 75);
                            adv.Shape_NxNSquareAt(playerID, "Zerg Defiler", 1, "50 + 1n Tank", 9, 75);

                            KillUnitAt(All, "100 + 1n Hyperion", "Anywhere", playerID);
                     }
                     else if (v.P_LoopMain[playerID] == 4) 
                     {
                            adv.Shape_NxNSquareAt(playerID, "Zerg Defiler", 1, "100 + 1n Hyperion", 9, 75);

                            KillUnitAt(All, "100 + 1n Hyperion", "Anywhere", playerID);
                     }

                     else if (v.P_LoopMain[playerID] >= 43 && v.P_LoopMain[playerID] < 53) 
                     {
                            var i = v.P_LoopMain[playerID] - 43;

                            adv.Shape_NxNSquareAt(playerID, "Zerg Defiler", 1, "Protoss Dark Archon", 11 - i, 75);

                            KillUnitAt(All, "Protoss Dark Archon", "Anywhere", playerID);
                     }
                     else if (v.P_LoopMain[playerID] >= 53)
                     {
                            RemoveUnitAt(All, "100 + 1n Hyperion", "Anywhere", playerID);

                            adv.Shape_NxNSquareAt(playerID, "Zerg Defiler", 1, "Protoss Dark Archon", 3, 75);
                            adv.Shape_NxNSquareAt(playerID, "Zerg Defiler", 1, "100 + 1n Hyperion", 3, 75);

                            MoveLocation(v.P_LocationID[playerID], "Zerg Defiler", playerID, "Anywhere");
                            Order("100 + 1n Hyperion", playerID, "Anywhere", Attack, v.P_LocationID[playerID]);  

                            KillUnitAt(All, "Protoss Dark Archon", "Anywhere", playerID);
                     }


                     trg.Main_Wait(80);

                     v.P_LoopMain[playerID] += 1;

                     if (v.P_LoopMain[playerID] == 72)
                     {                        
                            v.P_CountMain[playerID] += 1;
                            v.P_LoopMain[playerID] = 0;
                     }
              }     
              else if (v.P_CountMain[playerID] == 8)
              {
                     if (v.P_LoopMain[playerID] < 7) 
                     {
                            RemoveUnitAt(All, "100 + 1n Hyperion", "Anywhere", playerID);

                            adv.Shape_NxNSquareAt(playerID, "Zerg Defiler", 1, "Protoss Dark Archon", 3 + v.P_LoopMain[playerID], 75);
                            adv.Shape_NxNSquareAt(playerID, "Zerg Defiler", 1, "100 + 1n Hyperion", 3 + v.P_LoopMain[playerID], 75);

                            MoveLocation(v.P_LocationID[playerID], "Zerg Defiler", playerID, "Anywhere");
                            Order("100 + 1n Hyperion", playerID, "Anywhere", Attack, v.P_LocationID[playerID]);  

                            KillUnitAt(All, "Protoss Dark Archon", "Anywhere", playerID);
                     }
                     else if (v.P_LoopMain[playerID] < 16) 
                     {
                            KillUnitAt(9, "100 + 1n Hyperion", "Anywhere", playerID);
                            KillUnitAt(9, "50 + 1n Tank", "Anywhere", playerID);
                            KillUnitAt(9, "60 + 1n Siege", "Anywhere", playerID);
                     }

                     trg.Main_Wait(80);

                     v.P_LoopMain[playerID] += 1;

                     if (v.P_LoopMain[playerID] == 16)
                     {                        
                            v.P_CountMain[playerID] += 1;
                            v.P_LoopMain[playerID] = 0;
                     }
              }  
              else if (v.P_CountMain[playerID] == 9)
              {
                     RemoveUnitAt(All, "Zerg Defiler", "Anywhere", playerID);

                     SetSwitch("UiltimateSwitch", Clear);
                     trg.SkillEnd();
              }
       }
}